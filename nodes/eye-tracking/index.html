<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Marek S. Lukasiewicz" /><link rel="canonical" href="https://marsh-sim.github.io/nodes/eye-tracking/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Eye tracking - MARSH Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../external_links.css" rel="stylesheet" />
        <link href="../../mavlink_table.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Eye tracking";
        var mkdocs_page_input_path = "nodes/eye-tracking.md";
        var mkdocs_page_url = "/nodes/eye-tracking/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> MARSH Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Manager</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../manager/">MARSH Manager</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../manager/development/">Development</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Nodes</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../">Simulator nodes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../controls/">Controls</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../instruments/">Instruments</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../visualisation.md">Visualisation</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Eye tracking</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#defined-screens">Defined screens</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#instruments">Instruments</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#outside-view">Outside view</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#inceptors">Inceptors</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#drone-control">Drone control</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#creating-new-screens">Creating new screens</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../body-pose/">Body pose</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development/">Development</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Data analysis</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../analysis/matlab/">MATLAB</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">MAVLink definitions</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../mavlink/minimal/">Minimal Set</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../mavlink/common/">Subset of Common Set</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../mavlink/marsh/">MARSH Dialect</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Project</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../rationale/">Rationale</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../documentation/">Documentation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../bibliography/">Bibliography</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">MARSH Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Nodes</li>
      <li class="breadcrumb-item active">Eye tracking</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/marsh-sim/marsh-sim.github.io/edit/main/docs/nodes/eye-tracking.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="eye-tracking">Eye tracking</h1>
<p>This article describes setup for eye tracking experiments using a wearable eye tracker (not VR helmet).</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Eye tracking device, we're using <a href="https://pupil-labs.com/products/core">Pupil Labs Core</a></li>
<li><a href="https://github.com/pupil-labs/pupil">Pupil Capture</a> software on a computer with USB-C port to which the device will be connected</li>
<li><a href="https://www.pureref.com/">PureRef</a> art reference program for showing marker overlay <strong>on every computer showing a pilot screen</strong></li>
<li>Download <code>.pur</code> files from <a href="https://github.com/marsh-sim/sim-nodes/tree/main/eye_tracking">eye_tracking folder in <code>sim-nodes</code> repo</a> on computers with PureRef</li>
</ul>
<h2 id="usage">Usage</h2>
<p>The PureRef scenes are prepared to display <a href="https://github.com/AprilRobotics/apriltag-imgs/tree/master/tag36h11">AprilTags tag36h11 markers</a> in every corner of the screen.</p>
<p>Steps to use a scene on a given display.
The PureRef menu is opened by right clicking in the window, or any of the images when shown as overlay.</p>
<ol>
<li>Open the <code>.pur</code> file</li>
<li>With no selection, click "Mode &gt; Overlay Selection" and accept</li>
<li>Select <strong>all four</strong> images, can be done with <code>Ctrl+A</code> if some of them are off screen, drag and scale to fit the corners of the display</li>
<li>Check "Mode &gt; Always On Top"</li>
<li>Check "Canvas &gt; Lock Canvas"</li>
<li>Check "Mode &gt; Transparent To Mouse" and accept</li>
</ol>
<p>If you need to change anything after this point, you need to focus the PureRef window in a different way than clicking on it, for example from the taskbar.</p>
<h2 id="defined-screens">Defined screens</h2>
<p>The following are provided as reference for what is in <code>.pur</code> files found in the repository, and to propose some consistent values for <code>surface_id</code> field of <a href="../../mavlink/marsh/#EYE_TRACKING_DATA">EYE_TRACKING_DATA</a> message.</p>
<h3 id="instruments">Instruments</h3>
<p>Surface id <strong>1</strong>, example: page <code>pfd</code> of <a href="../instruments/">lidia</a>.</p>
<p><img alt="diagram of AprilTags layout for instrument screen" src="../markers_instruments.svg" /></p>
<h3 id="outside-view">Outside view</h3>
<p>Surface id <strong>2</strong> with a view outside the aircraft, or just the screen with visualisation</p>
<p><img alt="diagram of AprilTags layout for outside view" src="../markers_outside_view.svg" /></p>
<h3 id="inceptors">Inceptors</h3>
<p>Surface id <strong>3</strong> showing control positions, example: page <code>controls</code> of <a href="../instruments/">lidia</a>.</p>
<p><img alt="diagram of AprilTags layout for control positions" src="../markers_inceptors.svg" /></p>
<h3 id="drone-control">Drone control</h3>
<p>Surface id <strong>4</strong> for controlling cooperating Unmanned Aerial Vehicles (UAVs), example: an instance of <a href="http://qgroundcontrol.com/">QGroundControl</a></p>
<p><img alt="diagram of AprilTags layout for drone control" src="../markers_drone_control.svg" /></p>
<h2 id="creating-new-screens">Creating new screens</h2>
<p>The images in the AprilTags repository have a very small resolution, with pixels corresponding to marker features.
After loading them into PureRef and scaling to a a larger size they will look blurry.
To fix that, toggle image sampling on selected images to "nearest neighbor" with <code>Alt+T</code>, and/or set this sampling as default in the settings.</p>
<p>To keep a consistent size, open one of the reference images in full screen, and adjust one of the markers to match.
Once one marker in a scene has a correct size, select it first followed by any other, then right click and select "Images &gt; Normalize &gt; From first &gt; Size".</p>
<p>Similarly, when an image is positioned in a desired corner, select the reference first, then an image you want to move and use "Images &gt; Align &gt; Left/Up, etc.", which can also be done with <code>Ctrl</code> and arrow keys.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>As of writing, the images cannot cover the task bar in Windows.
It's suggested to align them with the taskbar instead, but when defining the surface in Pupil Capture, move the corner to corner of the display.</p>
</div>
<p>When finished, you can save the PureRef scene to <code>.pur</code> file using "Save &gt; Save as" menu.
This file is self-contained, including the data of all used images.</p>
<p>With the overlay shown on screen, follow the instructions about <a href="https://docs.pupil-labs.com/core/software/pupil-capture/#surface-tracking">Surface Tracking in Pupil Capture documentation</a>.
For the <a href="https://github.com/marsh-sim/sim-nodes/blob/main/pupil_eye_tracker.py"><code>pupil_eye_tracker</code></a> script to correctly label the surfaces, name the surfaces same way as subsections in <a href="#defined-screens">Defined screens</a>.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../instruments/" class="btn btn-neutral float-left" title="Instruments"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../body-pose/" class="btn btn-neutral float-right" title="Body pose">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Â© 2024, Marek S. Lukasiewicz, CC-BY 4.0</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/marsh-sim/marsh-sim.github.io" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../instruments/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../body-pose/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
